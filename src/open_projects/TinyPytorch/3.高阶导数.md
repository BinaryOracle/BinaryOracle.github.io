---
title: ğŸ§  ä»é›¶æ„å»ºæ·±åº¦å­¦ä¹ æ¡†æ¶ï¼ˆä¸‰ï¼‰ï¼šåŠ¨æ€å›¾å¯è§†åŒ–ä¸é«˜é˜¶å¯¼æ•°æ„å»º
icon: file
category:
  - å¼€æºé¡¹ç›®
  - TinyPytorch
tag:
  - å¼€æºé¡¹ç›®
  - TinyPytorch
  - å·²å‘å¸ƒ
footer: æŠ€æœ¯å…±å»ºï¼ŒçŸ¥è¯†å…±äº«
date: 2025-06-29
order: 1
author:
  - BinaryOracle
---

`1.TinyPytorch ç¬¬ä¸‰é˜¶æ®µ: é«˜é˜¶å¯¼æ•°ä¸æ·±åº¦å­¦ä¹ ä¼˜åŒ–è¿›é˜¶`
 
<!-- more -->

> ä»“åº“é“¾æ¥: [https://github.com/BinaryOracle/TinyPytorch](https://github.com/BinaryOracle/TinyPytorch)
> æœ¬èŠ‚ä»£ç : 
>

## å¼•è¨€ï¼šä»è‡ªåŠ¨å¾®åˆ†èµ°å‘â€œå¯è§†åŒ– + é«˜é˜¶å¯¼æ•° + çµæ´»æ§åˆ¶â€

éšç€ TinyPytorch æ¡†æ¶æ ¸å¿ƒåŠŸèƒ½çš„æ—¥ç›Šå®Œå–„ï¼Œæˆ‘ä»¬å¼€å§‹è¿ˆå…¥æ›´æ·±å…¥ä¹Ÿæ›´è´´è¿‘çœŸå®æ·±åº¦å­¦ä¹ æ¡†æ¶è®¾è®¡çš„é˜¶æ®µã€‚åœ¨å‰ä¸€é˜¶æ®µï¼Œæˆ‘ä»¬å®ç°äº†è‡ªåŠ¨æ„å»ºè®¡ç®—å›¾ä¸åå‘ä¼ æ’­çš„åŸºæœ¬æœºåˆ¶ï¼Œä½¿å¾—æ¨¡å‹è®­ç»ƒå…·å¤‡äº†åŸºç¡€çš„â€œå­¦ä¹ â€èƒ½åŠ›ã€‚

åœ¨ç¬¬ä¸‰é˜¶æ®µï¼Œæˆ‘ä»¬å°†ä»ç¬¬25æ­¥ç»§ç»­å‡ºå‘ï¼Œå›´ç»•è®¡ç®—å›¾å¯è§†åŒ–ã€é«˜é˜¶å¯¼æ•°æ„å»ºã€åŠ¨æ€å›¾æ§åˆ¶ä¸æ¡†æ¶çµæ´»æ€§å±•å¼€ä¸€ç³»åˆ—æ‰©å±•ä¸ä¼˜åŒ–ï¼š

* å¼•å…¥ Graphviz å®ç°è®¡ç®—å›¾çš„å¯è§†åŒ–æ¸²æŸ“ï¼Œå¸®åŠ©å¼€å‘è€…ç›´è§‚ç†è§£å‰å‘ä¸åå‘ä¼ æ’­è·¯å¾„ï¼›

* å®ç° `create_graph=True` æ”¯æŒé«˜é˜¶å¯¼æ•°çš„æ„å»ºï¼›

* å¼•å…¥ `sin`ã€`cos`ã€`tanh` ç­‰å‡½æ•°èŠ‚ç‚¹ï¼Œæ‰©å±•å‡½æ•°åº“å¹¶éªŒè¯é«˜é˜¶å¯¼æ•°ï¼›

* æ„å»ºæ³°å‹’å±•å¼€ã€ç‰›é¡¿æ³•ç­‰ç»å…¸å‡½æ•°é€¼è¿‘ä¸ä¼˜åŒ–ç¤ºä¾‹ï¼›

* å®Œå–„æ¡†æ¶çš„æ¨¡å—ç»“æ„ï¼Œä¼˜åŒ– `Function` ä¸ `Variable` çš„å†…å­˜ç®¡ç†ä¸æ‰§è¡Œæµç¨‹ã€‚

é€šè¿‡è¿™ 10 ä¸ªæ­¥éª¤ï¼ŒTinyPytorch ä¸ä»…å…·å¤‡äº†ç°ä»£æ¡†æ¶åº”æœ‰çš„å¯è§†åŒ–ä¸æ§åˆ¶èƒ½åŠ›ï¼Œè¿˜èƒ½å¤Ÿå¤„ç†æ›´å¤æ‚çš„è‡ªåŠ¨å¾®åˆ†ä»»åŠ¡ï¼Œä¸ºåç»­çš„ç¥ç»ç½‘ç»œæ¨¡å—ä¸è®­ç»ƒæœºåˆ¶æ‰“ä¸‹åšå®åŸºç¡€ã€‚æˆ‘ä»¬å°†çœ‹åˆ°ï¼Œå®ƒä¸ä»…æ˜¯â€œèƒ½è·‘èµ·æ¥â€ï¼Œè€Œæ˜¯çœŸæ­£æœç€â€œæ˜“ç”¨ã€æ¸…æ™°ã€é«˜æ•ˆâ€çš„æ–¹å‘è¿›åŒ–ã€‚

## æ­¥éª¤25: å¯è§†åŒ–è®¡ç®—å›¾

å½“å‰TinyPytorchå·²èƒ½å°†å¤æ‚å¼å­è½¬åŒ–ä¸ºä»£ç ï¼Œä½†éœ€ç›´è§‚å‘ˆç°è®¡ç®—å›¾å…¨è²Œä»¥è¾…åŠ©è°ƒè¯•ä¸ç†è§£ã€‚ä¸ºæ­¤å¼•å…¥ç¬¬ä¸‰æ–¹å·¥å…·Graphvizï¼Œå…¶æ”¯æŒèŠ‚ç‚¹å’Œç®­å¤´æ„æˆçš„æ•°æ®ç»“æ„å¯è§†åŒ–ï¼Œå¯ç”¨äºå±•ç¤ºTinyPytorchè®¡ç®—å›¾ã€‚  

- **macOSå®‰è£…**ï¼šé€šè¿‡Homebrewæ‰§è¡Œ `brew install graphviz`ã€‚  

- **Ubuntuå®‰è£…**ï¼šæ‰§è¡Œ `sudo apt install graphviz`ã€‚  

- **éªŒè¯å®‰è£…**ï¼šè¿è¡Œ `dot -V`ï¼Œè‹¥æ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯ï¼ˆå¦‚`dot - graphviz version 2.40.1`ï¼‰åˆ™å®‰è£…æˆåŠŸã€‚  

- **æ–‡ä»¶è½¬æ¢å‘½ä»¤**ï¼šä½¿ç”¨`dot sample.dot -T png -o sample.png`å°†DOTæ ¼å¼æ–‡ä»¶è½¬æ¢ä¸ºPNGå›¾åƒï¼Œå…¶ä¸­`-T`æŒ‡å®šè¾“å‡ºæ ¼å¼ï¼Œ`-o`æŒ‡å®šè¾“å‡ºæ–‡ä»¶åã€‚  

---

**DOTè¯­è¨€åŸºç¡€è¯­æ³•**:

- **ç®€å•èŠ‚ç‚¹å®šä¹‰**ï¼šå®šä¹‰åŒ…å«èŠ‚ç‚¹`x`å’Œ`y`çš„æœ‰å‘å›¾ï¼ŒèŠ‚ç‚¹é—´ç”¨æ¢è¡Œåˆ†éš”ã€‚  

```bash
digraph g { 
x 
y 
}
```
![](3/1.png)

- **èŠ‚ç‚¹å±æ€§è®¾ç½®**ï¼šå®šä¹‰èŠ‚ç‚¹IDä¸º1ï¼Œæ ‡ç­¾ä¸º`x`ï¼Œé¢œè‰²æ©™è‰²å¹¶å¡«å……ï¼›`shape=box`å¯å°†èŠ‚ç‚¹è®¾ä¸ºçŸ©å½¢ã€‚  

```bash
digraph g { 
1 [label="x", color=orange, style=filled]
2 [label="y", color=orange, style=filled, shape=box]
}
```
![](3/2.png)

- **èŠ‚ç‚¹è¿æ¥**ï¼šä½¿ç”¨`->`è¡¨ç¤ºç®­å¤´è¿æ¥ï¼Œå¦‚`1->2`è¡¨ç¤ºä»èŠ‚ç‚¹1åˆ°èŠ‚ç‚¹3çš„æœ‰å‘è¾¹ã€‚  

```bash
digraph g { 
1 [label="x", color=orange, style=filled]
2 [label="y", color=orange, style=filled]
1 ->  2
}
```
![](3/3.png)

**TinyPytorchè®¡ç®—å›¾è½¬æ¢ä¸ºDOTè¯­è¨€**:

```python
import numpy as np
from chapter3 import Variable
from chapter3 import get_dot_graph

x0 = Variable(np.array(1.0))
x1 = Variable(np.array(1.0))
y = x0 + x1
x0.name = 'x0'
x1.name = 'x1'
y.name = 'y'
txt = get_dot_graph(y, verbose=False)
print(txt)

with open('sample.dot', 'w') as f:
    f.write(txt)
```

- ä»£ç å°†å˜é‡`y`çš„è®¡ç®—å›¾è½¬æ¢ä¸ºDOTè¯­è¨€å­—ç¬¦ä¸²ï¼Œå¹¶ä¿å­˜ä¸ºæ–‡ä»¶ã€‚`verbose`å‚æ•°æ§åˆ¶æ˜¯å¦æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯ã€‚  

- è¾“å‡ºçš„DOTè¯­è¨€ç¤ºä¾‹åŒ…å«å˜é‡èŠ‚ç‚¹ï¼ˆæ©™è‰²åœ†å½¢ï¼‰å’Œå‡½æ•°èŠ‚ç‚¹ï¼ˆæµ…è“è‰²çŸ©å½¢ï¼‰ï¼Œå¦‚ï¼š  

```bash
digraph g {
4847712112 [label="y", color=orange, style=filled]
4847712064 [label="Add", color=lightblue, style=filled, shape=box]
4775983056 -> 4847712064
4847711968 -> 4847712064
4847712064 -> 4847712112
4775983056 [label="x0", color=orange, style=filled]
4847711968 [label="x1", color=orange, style=filled]
}
```  

è½¬æ¢åçš„å›¾åƒå±•ç¤º`x0 + x1`çš„è®¡ç®—å›¾ï¼ŒåŒ…å«`Add`å‡½æ•°èŠ‚ç‚¹å’Œå˜é‡è¿æ¥ã€‚  

![](3/4.png)

---

**æ ¸å¿ƒå‡½æ•°å®ç°åŸç†**:

- **`_dot_var`å‡½æ•°**ï¼šç”Ÿæˆå˜é‡èŠ‚ç‚¹çš„DOTæè¿°ï¼Œä½¿ç”¨`id(v)`ä½œä¸ºèŠ‚ç‚¹å”¯ä¸€IDï¼Œæ”¯æŒæ˜¾ç¤ºå˜é‡åã€å½¢çŠ¶å’Œæ•°æ®ç±»å‹ï¼š  
  
```python
def _dot_var(v, verbose=False):
    dot_var = '{} [label="{}", color=orange, style=filled]\n'

    name = '' if v.name is None else v.name
    if verbose and v.data is not None:
        if v.name is not None:
            name += ': '
        name += str(v.shape) + ' ' + str(v.dtype)

    return dot_var.format(id(v), name)
```

> ç¤ºä¾‹è¾“å‡ºï¼š`4423761088 [label="x: (2, 3) float64", color=orange, style=filled]`ã€‚  

- **`_dot_func`å‡½æ•°**ï¼šç”Ÿæˆå‡½æ•°èŠ‚ç‚¹çš„DOTæè¿°ï¼Œä½¿ç”¨å‡½æ•°ç±»åä½œä¸ºæ ‡ç­¾ï¼š  

```python
def _dot_func(f):
    # for function
    dot_func = '{} [label="{}", color=lightblue, style=filled, shape=box]\n'
    ret = dot_func.format(id(f), f.__class__.__name__)

    # for edge
    dot_edge = '{} -> {}\n'
    for x in f.inputs:
        ret += dot_edge.format(id(x), id(f))
    for y in f.outputs:  # y is weakref
        ret += dot_edge.format(id(f), id(y()))
    return ret
```

> ç¤ºä¾‹è¾“å‡ºï¼š`4423742632 [label="Add", color=lightblue, style=filled, shape=box]`ã€‚  

- **è®¡ç®—å›¾éå†é€»è¾‘**ï¼šä¸åå‘ä¼ æ’­ç±»ä¼¼ï¼Œä»è¾“å‡ºå˜é‡å‡ºå‘éå†æ‰€æœ‰èŠ‚ç‚¹ï¼ˆå˜é‡å’Œå‡½æ•°ï¼‰ï¼Œç”ŸæˆDOTè¯­è¨€å­—ç¬¦ä¸²ã€‚é€šè¿‡`seen_set`é¿å…é‡å¤å¤„ç†èŠ‚ç‚¹ï¼Œä½¿ç”¨`funcs.append(f)`å’Œ`funcs.pop()`å®ç°ååºéå†ã€‚  

```python
def get_dot_graph(output, verbose=True):
    txt = ''
    funcs = []
    seen_set = set()

    def add_func(f):
        if f not in seen_set:
            funcs.append(f)
            # funcs.sort(key=lambda x: x.generation)
            seen_set.add(f)

    add_func(output.creator)
    txt += _dot_var(output, verbose)

    while funcs:
        func = funcs.pop()
        txt += _dot_func(func)
        for x in func.inputs:
            txt += _dot_var(x, verbose)

            if x.creator is not None:
                add_func(x.creator)

    return 'digraph g {\n' + txt + '}'
```
---
**å¯è§†åŒ–å·¥å…·å°è£…**:

- **`plot_dot_graph`å‡½æ•°**ï¼šè‡ªåŠ¨æ‰§è¡ŒDOTæ–‡ä»¶è½¬æ¢å¹¶æ˜¾ç¤ºå›¾åƒï¼Œæ”¯æŒä¿å­˜ä¸ºPNGã€PDFç­‰æ ¼å¼ï¼š  

```python
def plot_dot_graph(output, verbose=True, to_file='graph.png'):
    dot_graph = get_dot_graph(output, verbose)

    tmp_dir = os.path.join(os.path.expanduser('~'), '.dezero')
    if not os.path.exists(tmp_dir):
        os.mkdir(tmp_dir)
    graph_path = os.path.join(tmp_dir, 'tmp_graph.dot')

    with open(graph_path, 'w') as f:
        f.write(dot_graph)

    extension = os.path.splitext(to_file)[1][1:]  # Extension(e.g. png, pdf)
    cmd = 'dot {} -T {} -o {}'.format(graph_path, extension, to_file)
    subprocess.run(cmd, shell=True)

    # Return the image as a Jupyter Image object, to be displayed in-line.
    try:
        from IPython import display
        return display.Image(filename=to_file)
    except:
        pass
```

è¯¥å‡½æ•°è‡ªåŠ¨è°ƒç”¨ç³»ç»Ÿå‘½ä»¤è½¬æ¢æ–‡ä»¶ï¼Œå¹¶æ”¯æŒåœ¨Jupyter Notebookä¸­ç›´æ¥æ˜¾ç¤ºå›¾åƒã€‚  

---

**å¤æ‚å‡½æ•°å¯è§†åŒ–ç¤ºä¾‹**: ä»¥Goldstein-Priceå‡½æ•°ä¸ºä¾‹

```python
import numpy as np
from chapter3 import plot_dot_graph, Variable

def goldstein(x, y):
    z = (1 + (x + y + 1)**2 * (19 - 14*x + 3*x**2 - 14*y + 6*x*y + 3*y**2)) * \
        (30 + (2*x - 3*y)** 2 * (18 - 32*x + 12*x**2 + 48*y - 36*x*y + 27*y**2))
    return z

x = Variable(np.array(1.0))
y = Variable(np.array(1.0))
z = goldstein(x, y)
z.backward()
x.name = 'x'
y.name = 'y'
z.name = 'z'
plot_dot_graph(z, to_file='goldstein.png')
```

å¯è§†åŒ–ç»“æœæ˜¾ç¤ºå¤æ‚è®¡ç®—å›¾ï¼ŒåŒ…å«å¤šå±‚`Pow`ã€`Mul`ã€`Add`ç­‰æ“ä½œèŠ‚ç‚¹ï¼ŒéªŒè¯DeZeroå¯¹å¤æ‚è¡¨è¾¾å¼çš„è®¡ç®—å›¾æ„å»ºèƒ½åŠ›ã€‚

![](3/5.png)

## æ­¥éª¤26: å¯»æ‰¾å‡½æ•°æœ€ä¼˜è§£

æœ¬æ­¥éª¤å°†å¤„ç†Rosenbrockå‡½æ•°ï¼Œå…¶å¼å­ä¸ºï¼š

$$
y=100\left(x_{1}-x_{0}^{2}\right)^{2}+\left(x_{0}-1\right)^{2}
$$

è¯¥å‡½æ•°çš„å½¢çŠ¶å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œè‹¥ç”»å‡ºå…¶â€œå±±â€çš„ç­‰é«˜çº¿ï¼Œä¼šå‘ç°çº¿çš„å½¢çŠ¶ç±»ä¼¼é¦™è•‰ï¼Œå› æ­¤Rosenbrockå‡½æ•°ä¹Ÿè¢«ç§°ä¸ºâ€œé¦™è•‰å‡½æ•°â€ã€‚

![](3/6.png)


æœ¬æ­¥éª¤çš„ç›®æ ‡æ˜¯æ‰¾åˆ°ä½¿Rosenbrockå‡½æ•°è¾“å‡ºå€¼æœ€å°çš„$x_{0}$å’Œ$x_{1}$ã€‚å·²çŸ¥Rosenbrockå‡½æ•°çš„æœ€å°å€¼åœ¨$(x_{0}, x_{1})=(1,1)$å¤„ï¼Œæ¥ä¸‹æ¥å°†ä½¿ç”¨TinyPytorchéªŒè¯æ˜¯å¦èƒ½æ‰¾åˆ°è¯¥æœ€å°å€¼ã€‚

Rosenbrockå‡½æ•°çš„ä¸¥æ ¼å®šä¹‰æ˜¯$f(x_{0}, x_{1})=b(x_{1}-x_{0}^{2})^{2}+(a-x_{0})^{2}$ï¼Œå…¶ä¸­$a$å’Œ$b$æ˜¯å¸¸æ•°ã€‚ä¸Šè¿°ä¾‹å­æ˜¯$a=1$ã€$b=100$æ—¶çš„Rosenbrockå‡½æ•°ï¼Œè¯¥å‡½æ•°å¸¸ä½œä¸ºä¼˜åŒ–é—®é¢˜çš„åŸºå‡†å‡½æ•°ä½¿ç”¨ã€‚

é¦–å…ˆæ±‚Rosenbrockå‡½æ•°åœ¨$(x_{0}, x_{1})=(0.0,2.0)$å¤„çš„å¯¼æ•°$\frac{\partial y}{\partial x_{0}}$å’Œ$\frac{\partial y}{\partial x_{1}}$ï¼Œä½¿ç”¨TinyPytorchå®ç°çš„ä»£ç å¦‚ä¸‹ï¼š

```python
import numpy as np
from chapter3 import Variable


def rosenbrock(x0, x1):
    y = 100 * (x1 - x0 ** 2) ** 2 + (x0 - 1) ** 2
    return y

x0 = Variable(np.array(0.0))
x1 = Variable(np.array(2.0))
y = rosenbrock(x0, x1)
y.backward()
print(x0.grad, x1.grad)
```
è¿è¡Œç»“æœä¸ºï¼š

> -2.0 400.0

è¿™é‡Œå°†æ•°å€¼æ•°æ®å°è£…åœ¨Variableä¸­ï¼Œé€šè¿‡backward()æ–¹æ³•æ±‚å¯¼ã€‚å¾—åˆ°çš„$x_{0}$å¯¼æ•°ä¸º-2.0ï¼Œ$x_{1}$å¯¼æ•°ä¸º400.0ã€‚æ¢¯åº¦å±•ç¤ºäº†å„ç‚¹ä¸Šå‡½æ•°è¾“å‡ºå€¼å¢åŠ æœ€å¿«çš„æ–¹å‘ï¼Œåœ¨ç‚¹$(x_{0}, x_{1})=(0.0,2.0)$ä¸Šï¼Œ$y$å€¼å¢åŠ æœ€å¿«çš„æ–¹å‘æ˜¯(-2.0,400.0)ï¼Œé‚£ä¹ˆ$y$å€¼å‡å°‘æœ€å¿«çš„æ–¹å‘æ˜¯(2.0,-400.0)ã€‚


**æ¢¯åº¦ä¸‹é™æ³•è§£å†³é—®é¢˜**:

å¯¹äºå½¢çŠ¶å¤æ‚çš„å‡½æ•°ï¼Œå…¶æœ€å¤§å€¼å¯èƒ½ä¸åœ¨æ¢¯åº¦æŒ‡ç¤ºæ–¹å‘ï¼Œæœ€å°å€¼ä¹Ÿå¯èƒ½ä¸åœ¨æ¢¯åº¦åæ–¹å‘ï¼Œä½†ä»å±€éƒ¨çœ‹ï¼Œæ¢¯åº¦è¡¨ç¤ºå‡½æ•°è¾“å‡ºå€¼æœ€å¤§çš„æ–¹å‘ã€‚**é‡å¤å‘æ¢¯åº¦æ–¹å‘ç§»åŠ¨ä¸€å®šè·ç¦»ï¼Œå†æ±‚æ¢¯åº¦ï¼Œå¯é€æ¸æ¥è¿‘ç›®æ ‡ä½ç½®ï¼Œè¿™å°±æ˜¯æ¢¯åº¦ä¸‹é™æ³•**ã€‚è‹¥ä»å¥½çš„èµ·ç‚¹å¼€å§‹ï¼Œä½¿ç”¨æ¢¯åº¦ä¸‹é™æ³•èƒ½é«˜æ•ˆæ‰¾åˆ°ç›®æ ‡å€¼ã€‚

ä½¿ç”¨æ¢¯åº¦ä¸‹é™æ³•å¯»æ‰¾Rosenbrockå‡½æ•°æœ€å°å€¼çš„ä»£ç å¦‚ä¸‹:

```python
x0 = Variable(np.array(0.0)) 
x1 = Variable(np.array(2.0)) 
lr = 0.001 
iters = 1000

for i in range(iters): 
    y = rosenbrock(x0, x1) 
    
    x0.cleargrad() 
    x1.cleargrad() 
    
    y.backward() 

    x0.data -= lr * x0.grad 
    x1.data -= lr * x1.grad
```

ä»£ç ä¸­ï¼Œè¿­ä»£æ¬¡æ•°è®¾ä¸ºitersï¼ˆitersæ˜¯iterationsçš„ç¼©å†™ï¼‰ï¼Œä¸æ¢¯åº¦ç›¸ä¹˜çš„å€¼è®¾ä¸ºlr=0.001ï¼ˆlræ˜¯learning rateçš„ç¼©å†™ï¼Œå³å­¦ä¹ ç‡ï¼‰ã€‚

ç”±äºforè¯­å¥åå¤ä½¿ç”¨Variableå®ä¾‹x0å’Œx1æ±‚å¯¼ï¼Œè€Œæ¯æ¬¡åå‘ä¼ æ’­æ—¶å¯¼æ•°ä¼šç´¯åŠ ï¼Œæ‰€ä»¥åœ¨åå‘ä¼ æ’­å‰éœ€è°ƒç”¨å„å˜é‡çš„cleargradæ–¹æ³•é‡ç½®å¯¼æ•°ã€‚

è¿è¡Œä»£ç ï¼Œä»è¾“å‡ºä¿¡æ¯å¯çœ‹åˆ°(x0,x1)å€¼çš„æ›´æ–°è¿‡ç¨‹ï¼Œéƒ¨åˆ†ç»“æœå¦‚ä¸‹ï¼š

```bash
iter 992: x0 = 0.682166, x1 = 0.463833
iter 993: x0 = 0.682388, x1 = 0.464137
iter 994: x0 = 0.682609, x1 = 0.464440
iter 995: x0 = 0.682830, x1 = 0.464743
iter 996: x0 = 0.683051, x1 = 0.465046
iter 997: x0 = 0.683271, x1 = 0.465348
iter 998: x0 = 0.683492, x1 = 0.465651
iter 999: x0 = 0.683712, x1 = 0.465953
```
å°†è®¡ç®—ç»“æœç»˜åˆ¶åœ¨å›¾ä¸Šï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œä»å›¾ä¸­å¯çœ‹å‡ºé€æ¸æ¥è¿‘æ˜Ÿå·æ‰€æŒ‡çš„ç›®çš„åœ°ä½ç½®ï¼Œä½†å°šæœªåˆ°è¾¾ã€‚

![](3/7.png)

å¢åŠ è¿­ä»£æ¬¡æ•°è®¾ä¸º iters =10000ï¼Œç»“æœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæ­¤æ—¶ç¦»ç›®çš„åœ°æ›´è¿‘ï¼Œ(x0,x1)çš„å€¼ä¸º(0.99449622,0.98900063)ã€‚

![](3/8.png)

è‹¥å†å¢åŠ è¿­ä»£æ¬¡æ•°åˆ° iters =50000ï¼Œå°±ä¼šæŠµè¾¾(1.0,1.0)ã€‚

> åŒ…å«ç»˜å›¾çš„å®Œæ•´ä»£ç :

```python
import numpy as np
from matplotlib import pyplot as plt
from chapter3 import Variable

def rosenbrock(x0, x1):
    y = 100 * (x1 - x0 ** 2) ** 2 + (x0 - 1) ** 2
    return y

x0 = Variable(np.array(0.0))
x1 = Variable(np.array(2.0))
lr = 0.001
iters = 50000

x0_list = []
x1_list = []

for i in range(iters):
    y = rosenbrock(x0, x1)

    x0.cleargrad()
    x1.cleargrad()

    y.backward()

    x0.data -= lr * x0.grad
    x1.data -= lr * x1.grad

    x0_list.append(x0.data.copy())
    x1_list.append(x1.data.copy())

    print('iter %d: x0 = %f, x1 = %f' % (i, x0.data, x1.data))

# ç»˜åˆ¶ç­‰é«˜çº¿å›¾
x = np.linspace(-2, 2, 400)
y = np.linspace(-1, 3, 400)
X, Y = np.meshgrid(x, y)
Z = (1 - X)**2 + 100 * (Y - X**2)**2

plt.figure(figsize=(8, 6))
cp = plt.contour(X, Y, Z, levels=np.logspace(-1, 3, 30), cmap='jet')
plt.plot(x0_list, x1_list, 'o-', color='yellow', markersize=2, label='Gradient Descent Path')

# åœ¨ (1.0, 1.0) å¤„æ ‡è®°æœ€ä¼˜ç‚¹
plt.plot(1.0, 1.0, marker='*', markersize=12, color='red', label='Minimum (1,1)')

plt.xlabel('x0')
plt.ylabel('x1')
plt.title('Gradient Descent on Rosenbrock Function')
plt.legend()
plt.grid(True)
plt.show()
```

æœ¬æ­¥éª¤ä½¿ç”¨TinyPytorchå®ç°äº†æ¢¯åº¦ä¸‹é™æ³•ï¼Œæ‰¾åˆ°äº†Rosenbrockå‡½æ•°æœ€å°å€¼çš„ä½ç½®ï¼Œä¸è¿‡è¿­ä»£æ¬¡æ•°è¾ƒå¤šï¼Œæœ‰5ä¸‡æ¬¡ã€‚å®é™…ä¸Šæ¢¯åº¦ä¸‹é™æ³•å¹¶ä¸æ“…é•¿å¤„ç†Rosenbrockè¿™ç§ç±»å‹çš„å‡½æ•°ï¼Œä¸‹ä¸€ä¸ªæ­¥éª¤ä¼šä»‹ç»å¹¶å®ç°å¦ä¸€ç§ä¼˜åŒ–æ–¹æ³•ã€‚

## æ­¥éª¤27: é«˜é˜¶å¯¼æ•°

